<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terminal de Ciberseguridad - Acceso Root</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-main: #020402;
            --bg-panel: #0d110d;
            --primary-green: #00ff41; 
            --secondary-green: #003b00; 
            --text-dim: #2e8b57;
            --alert: #ff3333;
            /* Color para los puntos de ayuda */
            --valid-indicator: rgba(0, 255, 65, 0.6);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Share Tech Mono', monospace;
            background-color: var(--bg-main);
            color: var(--primary-green);
            min-height: 100vh;
            padding: 20px;
            /* Efecto Scanlines */
            background-image: linear-gradient(rgba(0, 255, 65, 0.03) 1px, transparent 1px);
            background-size: 100% 4px;
            overflow-x: hidden;
        }

        /* --- HEADER --- */
        header {
            margin-bottom: 30px;
            border-bottom: 2px solid var(--primary-green);
            padding-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        h1 {
            font-size: 2.2rem;
            text-shadow: 0 0 10px var(--primary-green);
            letter-spacing: 2px;
        }

        .sys-info {
            text-align: right;
            font-size: 0.8rem;
            color: var(--text-dim);
            line-height: 1.5;
        }

        /* --- PANTALLAS --- */
        .screen { display: none; animation: fadeIn 0.5s; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- MENU GRID (6 NODOS) --- */
        .problem-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 30px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .problem-card {
            background-color: var(--bg-panel);
            border: 1px solid var(--text-dim);
            padding: 25px;
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 260px;
            cursor: pointer;
        }

        .problem-card:hover {
            border-color: var(--primary-green);
            box-shadow: 0 0 30px rgba(0, 255, 65, 0.15);
            transform: translateY(-5px);
            background-color: #0f1a0f;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px dashed var(--secondary-green);
            padding-bottom: 10px;
        }

        .problem-id {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-green);
        }

        .status-dot {
            height: 10px; width: 10px;
            background-color: var(--alert);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--alert);
            animation: pulse 2s infinite;
        }

        .log-text {
            color: #888;
            font-size: 0.9rem;
            line-height: 1.4;
            flex-grow: 1;
            font-family: 'Courier New', Courier, monospace; 
        }

        .log-text::before { content: "> "; color: var(--primary-green); }

        .metadata {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: var(--text-dim);
            margin-top: 20px;
            border-top: 1px solid var(--secondary-green);
            padding-top: 10px;
        }

        .btn-connect {
            position: absolute; bottom: 25px; right: 25px;
            background: transparent; border: 1px solid var(--primary-green);
            color: var(--primary-green); padding: 5px 15px;
            font-family: 'Share Tech Mono', monospace; text-transform: uppercase;
            cursor: pointer; opacity: 0; transition: opacity 0.3s;
        }
        .problem-card:hover .btn-connect { opacity: 1; }

        /* --- INTERFAZ DE JUEGO --- */
        #game-interface {
            display: none;
            max-width: 1200px;
            margin: 0 auto;
            grid-template-columns: 1fr 350px;
            gap: 2rem;
        }
        #game-interface.active { display: grid; }

        .board-container {
            display: flex; justify-content: center; align-items: center;
            background: #050505; border: 1px solid var(--text-dim);
            padding: 20px; position: relative;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(8, 70px);
            grid-template-rows: repeat(8, 70px);
            border: 2px solid var(--primary-green);
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.1);
        }

        .square {
            display: flex; align-items: center; justify-content: center;
            font-size: 45px; cursor: pointer; position: relative;
        }

        .light { background-color: #0a140a; color: var(--primary-green); }
        .dark { background-color: #020502; color: var(--primary-green); }
        
        /* Highlight Selección */
        .square.selected { background-color: rgba(0, 255, 65, 0.2) !important; box-shadow: inset 0 0 10px var(--primary-green); }
        
        /* --- VISUALIZACIÓN DE MOVIMIENTOS (JUGABILIDAD) --- */
        
        /* 1. Punto Verde (Movimiento válido a casilla vacía) */
        .valid-move::after {
            content: ''; position: absolute;
            width: 18px; height: 18px;
            background-color: var(--valid-indicator);
            border-radius: 50%;
            box-shadow: 0 0 8px var(--primary-green);
        }
        
        /* 2. Mira de Captura (Comer pieza enemiga) */
        .capture-move {
            box-shadow: inset 0 0 15px var(--alert);
        }
        .capture-move::after {
            content: ''; position: absolute;
            width: 80%; height: 80%;
            border: 2px dashed var(--alert);
            box-sizing: border-box;
            border-radius: 50%;
            animation: spin 4s linear infinite;
        }

        /* --- PANEL LATERAL --- */
        .side-panel {
            background: var(--bg-panel); border: 1px solid var(--primary-green);
            padding: 20px; display: flex; flex-direction: column;
        }

        .terminal-output {
            flex-grow: 1; background: black; border: 1px solid #333;
            padding: 10px; font-size: 0.85rem; color: #ccc;
            overflow-y: auto; font-family: 'Courier New', monospace;
            margin-bottom: 20px; height: 300px;
        }
        .line { margin-bottom: 5px; }
        .line.sys { color: var(--primary-green); }
        .line.err { color: var(--alert); }

        .btn-action {
            width: 100%; padding: 12px;
            background: transparent; border: 1px solid var(--primary-green);
            color: var(--primary-green); font-family: 'Share Tech Mono';
            cursor: pointer; margin-bottom: 10px; text-transform: uppercase;
            font-weight: bold; transition: 0.3s;
        }
        .btn-action:hover { background: var(--primary-green); color: black; }
        .btn-action:disabled { border-color: #555; color: #555; cursor: not-allowed; background: transparent; }

        .cipher-input {
            width: 100%; background: #111; border: 1px solid var(--primary-green);
            color: white; padding: 10px; margin-bottom: 10px;
            font-family: monospace; text-align: center;
        }

        /* --- OVERLAYS --- */
        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 100;
            display: none; justify-content: center; align-items: center;
        }
        .overlay.active { display: flex; }
        .data-box {
            border: 2px solid var(--primary-green); padding: 40px;
            text-align: center; background: #000; box-shadow: 0 0 30px var(--primary-green);
        }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Responsive */
        @media (max-width: 900px) {
            #game-interface { grid-template-columns: 1fr; }
            .board { grid-template-columns: repeat(8, 40px); grid-template-rows: repeat(8, 40px); }
            .square { font-size: 28px; }
            .capture-move::after { width: 100%; height: 100%; }
        }
    </style>
</head>
<body>

    <header>
        <h1>SISTEMA_VIGILANCIA_V4</h1>
        <div class="sys-info">
            UPTIME: 404h 21m<br>
            ENCRIPTACIÓN: AES-256<br>
            USUARIO: INVITADO
        </div>
    </header>

    <div id="menu-screen" class="screen active">
        <div class="problem-grid">
            
            <div class="problem-card" onclick="loadLevel(1)">
                <div class="card-header"><span class="problem-id"># NODE_01</span><span class="status-dot"></span></div>
                <div class="log-text">ERROR 503: Servicio de autenticación no responde.<br>Gateway inaccesible.<br>Solicitando credenciales manuales...</div>
                <div class="metadata"><span>PORT: 8080</span><span>LOCK: ACTIVE</span></div>
                <button class="btn-connect">CONECTAR</button>
            </div>

            <div class="problem-card" onclick="loadLevel(2)">
                <div class="card-header"><span class="problem-id"># NODE_02</span><span class="status-dot"></span></div>
                <div class="log-text">Tráfico interceptado.<br>Checksum inválido.<br>Datos ilegibles en el stream de datos.</div>
                <div class="metadata"><span>TYPE: STREAM</span><span>ENC: UNKNOWN</span></div>
                <button class="btn-connect">CONECTAR</button>
            </div>

            <div class="problem-card" onclick="loadLevel(3)">
                <div class="card-header"><span class="problem-id"># NODE_03</span><span class="status-dot"></span></div>
                <div class="log-text">Violación de segmento detectada.<br>Volcado de pila incompleto.<br>Se requiere análisis de estructura interna.</div>
                <div class="metadata"><span>ADDR: 0x0F4A</span><span>MEM: CORRUPT</span></div>
                <button class="btn-connect">CONECTAR</button>
            </div>

            <div class="problem-card" onclick="loadLevel(4)">
                <div class="card-header"><span class="problem-id"># NODE_04</span><span class="status-dot"></span></div>
                <div class="log-text">Alerta de seguridad: Protocolo interrumpido.<br>Exceso de peticiones en cola.<br>Sistema inestable.</div>
                <div class="metadata"><span>PID: 4421</span><span>STATUS: HALTED</span></div>
                <button class="btn-connect">CONECTAR</button>
            </div>

            <div class="problem-card" onclick="loadLevel(5)">
                <div class="card-header"><span class="problem-id"># NODE_05</span><span class="status-dot"></span></div>
                <div class="log-text">Anomalía en capa de transporte.<br>Latencia inusual detectada en clúster externo.<br>Origen de datos oculto.</div>
                <div class="metadata"><span>NET: TCP/IP</span><span>FLAG: SYN_ACK</span></div>
                <button class="btn-connect">CONECTAR</button>
            </div>

            <div class="problem-card" onclick="loadLevel(6)">
                <div class="card-header"><span class="problem-id"># NODE_06</span><span class="status-dot"></span></div>
                <div class="log-text">¡CRÍTICO! Archivo del sistema bloqueado.<br>Firma digital no reconocida.<br>Acceso administrativo revocado.</div>
                <div class="metadata"><span>LEVEL: KERNEL</span><span>PERM: DENIED</span></div>
                <button class="btn-connect">CONECTAR</button>
            </div>

        </div>
    </div>

    <div id="game-interface" class="screen">
        <div class="board-container">
            <div id="board" class="board"></div>

            <div id="victory-overlay" class="overlay">
                <div class="data-box">
                    <h2 style="color:var(--primary-green); margin-bottom:10px;">ACCESO CONCEDIDO</h2>
                    <p style="color:#ccc; margin-bottom:20px;">Hash desencriptado:</p>
                    <div id="hash-display" style="font-size:1.5rem; font-weight:bold; margin-bottom:20px; border:1px dashed var(--primary-green); padding:10px;">---</div>
                    <button class="btn-action" onclick="closeOverlay()">CERRAR Y COPIAR</button>
                </div>
            </div>
        </div>

        <div class="side-panel">
            <button class="btn-action" onclick="returnToMenu()" style="border-color:#555; color:#888;">&lt; DESCONECTAR</button>
            <div style="margin:10px 0; color:#555;">// CONSOLA DEL SISTEMA</div>
            <div id="terminal" class="terminal-output"></div>

            <div style="margin-top:auto;">
                <p style="font-size:0.8rem; margin-bottom:5px; color:#555;">INPUT SEGURO:</p>
                <input type="text" id="solution-input" class="cipher-input" placeholder="BLOQUEADO" disabled>
                <button id="submit-btn" class="btn-action" onclick="verifySolution()" disabled>INJECT_PAYLOAD</button>
                <div id="feedback-msg" style="text-align:center; height:20px; font-weight:bold; font-size:0.8rem;"></div>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURACIÓN DE NIVELES (Mapeados para el ejemplo)
        const levels = {
            1: {
                initial: [
                    ['', '', '', '', 'b', '', '', ''],
                    ['', '', 'p', '', 'B', '', 'p', ''],
                    ['', '', '', '', '', '', '', ''],
                    ['', '', 'P', '', '', 'p', 'P', ''],
                    ['', 'P', '', 'P', '', 'P', '', 'P'],
                    ['', '', 'p', '', 'K', '', 'p', ''],
                    ['', '', 'P', '', 'B', '', 'P', ''],
                    ['', '', '', '', 'k', '', '', '']
                ],
                moves: [
                    { w: {f:{r:3,c:6}, t:{r:2,c:6}}, b: {f:{r:1,c:2}, t:{r:2,c:2}} },
                    { w: {f:{r:4,c:7}, t:{r:3,c:7}}, b: {f:{r:0,c:4}, t:{r:1,c:3}} },
                    { w: {f:{r:1,c:4}, t:{r:4,c:7}}, b: {f:{r:1,c:3}, t:{r:0,c:2}} },
                    { w: {f:{r:4,c:7}, t:{r:5,c:6}}, b: null }
                ],
                code: "SQL-INJECT-01", answer: "ADMIN"
            },
            2: {
                initial: [
                    ['', '', 'k', '', '', '', '', ''],
                    ['', '', '', '', '', '', '', ''],
                    ['', '', '', '', 'K', '', '', ''],
                    ['', '', '', 'N', 'B', '', '', ''],
                    ['', '', '', '', 'N', '', '', ''],
                    ['', '', '', '', '', '', '', ''],
                    ['', '', '', '', '', '', '', ''],
                    ['', '', '', '', '', '', '', '']
                ],
                moves: [
                    { w: {f:{r:4,c:4}, t:{r:3,c:2}}, b: {f:{r:0,c:2}, t:{r:0,c:3}} },
                    { w: {f:{r:2,c:4}, t:{r:1,c:5}}, b: {f:{r:0,c:3}, t:{r:0,c:2}} },
                    { w: {f:{r:3,c:3}, t:{r:2,c:1}}, b: {f:{r:0,c:2}, t:{r:0,c:3}} },
                    { w: {f:{r:3,c:2}, t:{r:2,c:4}}, b: null }
                ],
                code: "CESAR-ROT13", answer: "SECRET"
            },
            3: {
                initial: [
                    ['', 'n', '', 'b', '', 'r', 'k', ''],
                    ['', '', 'p', 'p', '', '', '', 'p'],
                    ['', '', '', 'p', '', '', 'p', 'Q'],
                    ['', '', '', 'R', '', 'p', '', ''],
                    ['', '', '', '', 'B', 'B', 'P', ''],
                    ['', '', '', 'P', 'R', '', 'P', ''],
                    ['', '', '', '', '', '', 'P', 'K'],
                    ['', '', '', '', '', '', '', '']
                ],
                moves: [
                    { w: {f:{r:3,c:3}, t:{r:3,c:5}}, b: {f:{r:0,c:5}, t:{r:3,c:5}} },
                    { w: {f:{r:4,c:4}, t:{r:3,c:3}}, b: {f:{r:3,c:5}, t:{r:3,c:3}} },
                    { w: {f:{r:5,c:4}, t:{r:0,c:4}}, b: {f:{r:0,c:6}, t:{r:1,c:5}} },
                    { w: {f:{r:2,c:7}, t:{r:0,c:5}}, b: null }
                ],
                code: "STACK-OVERFLOW", answer: "ROOT"
            }
        };
        // Replicamos niveles para 4, 5 y 6
        levels[4] = levels[1];
        levels[5] = levels[2];
        levels[6] = levels[3];

        const pieces = { 'K': '♔', 'Q': '♕', 'R': '♖', 'B': '♗', 'N': '♘', 'P': '♙', 'k': '♚', 'q': '♛', 'r': '♜', 'b': '♝', 'n': '♞', 'p': '♟' };
        
        let currentState = { level: 1, pos: [], moveIdx: 0, selection: null, locked: false, validMoves: [] };

        // --- SISTEMA DE GESTIÓN ---

        function loadLevel(lvl) {
            currentState.level = lvl;
            currentState.pos = JSON.parse(JSON.stringify(levels[lvl].initial));
            currentState.moveIdx = 0;
            currentState.selection = null;
            currentState.locked = false;
            currentState.validMoves = [];
            
            document.getElementById('menu-screen').classList.remove('active');
            document.getElementById('game-interface').classList.add('active');
            
            lockInput();
            document.getElementById('terminal').innerHTML = '';
            log(`Iniciando conexión segura a NODE_0${lvl}...`, 'sys');
            drawBoard();
        }

        function returnToMenu() {
            document.getElementById('game-interface').classList.remove('active');
            document.getElementById('menu-screen').classList.add('active');
        }

        function drawBoard() {
            const board = document.getElementById('board');
            board.innerHTML = '';
            
            for(let r=0; r<8; r++) {
                for(let c=0; c<8; c++) {
                    const sq = document.createElement('div');
                    sq.className = `square ${(r+c)%2===0 ? 'light' : 'dark'}`;
                    
                    const p =
