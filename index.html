<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laboratorio de Álgebra Lineal</title>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,400;0,700;1,400&family=Roboto+Mono:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-blueprint: #1e3a8a; /* Azul ingeniería */
            --grid-line: rgba(255, 255, 255, 0.1);
            --text-main: #ffffff;
            --accent: #facc15; /* Amarillo técnico */
            --panel-bg: rgba(255, 255, 255, 0.05);
            --border: 1px solid rgba(255, 255, 255, 0.2);
            --success: #4ade80;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Roboto Mono', monospace;
            background-color: var(--bg-blueprint);
            color: var(--text-main);
            height: 100vh;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            
            /* EFECTO PAPEL MILIMETRADO */
            background-image: 
                linear-gradient(var(--grid-line) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-line) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        header {
            padding: 1.5rem 2rem;
            border-bottom: 2px solid white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(30, 58, 138, 0.9);
            backdrop-filter: blur(5px);
            z-index: 10;
        }

        h1 {
            font-family: 'Merriweather', serif;
            font-style: italic;
            font-size: 1.8rem;
        }

        .subtitle { font-size: 0.9rem; opacity: 0.8; }

        /* PANTALLAS */
        .screen {
            display: none;
            flex-grow: 1;
            padding: 2rem;
            animation: fadeIn 0.8s ease-out;
        }
        .screen.active { display: flex; }

        /* VISTA 1: SELECCIÓN (TARJETAS) */
        #mission-select-screen {
            flex-direction: column;
            align-items: center;
        }

        .intro-text {
            text-align: center;
            max-width: 800px;
            margin-bottom: 2rem;
            font-family: 'Merriweather', serif;
            line-height: 1.6;
        }

        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            width: 100%;
            max-width: 1200px;
        }

        .math-card {
            background: var(--panel-bg);
            border: 2px solid white;
            padding: 2rem;
            cursor: pointer;
            transition: transform 0.3s, background 0.3s;
            position: relative;
        }

        .math-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent);
        }

        .card-number {
            position: absolute;
            top: 10px; right: 15px;
            font-size: 3rem;
            font-weight: bold;
            opacity: 0.1;
            font-family: 'Merriweather', serif;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: var(--accent);
            text-transform: uppercase;
        }

        .card-desc { font-size: 0.9rem; line-height: 1.5; color: #ddd; }

        /* VISTA 2: INTERFAZ DE JUEGO */
        #game-interface {
            display: none;
            grid-template-columns: 1fr 350px;
            gap: 2rem;
            height: 100%;
            padding: 0 2rem 2rem 2rem;
        }
        #game-interface.active { display: grid; }

        .board-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 4px;
        }

        /* TABLERO ESTILO PLANO TÉCNICO */
        .board {
            display: grid;
            grid-template-columns: repeat(8, 70px);
            grid-template-rows: repeat(8, 70px);
            border: 4px solid white;
            background: white; 
        }

        .square {
            display: flex; align-items: center; justify-content: center;
            font-size: 45px; cursor: pointer;
        }

        /* Colores de las casillas */
        .light { background-color: #e0f2fe; color: #000; }
        .dark { background-color: #3b82f6; color: #fff; } 
        
        .square:hover { opacity: 0.9; }
        .selected { background-color: var(--accent) !important; color: #000 !important; }
        
        /* PANEL LATERAL */
        .side-panel {
            background: var(--panel-bg);
            border: 2px solid white;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
        }

        .back-btn {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.5);
            color: white;
            padding: 0.5rem 1rem;
            cursor: pointer;
            margin-bottom: 1.5rem;
            font-family: 'Roboto Mono', monospace;
            align-self: flex-start;
        }
        .back-btn:hover { background: white; color: var(--bg-blueprint); }

        .log-area {
            flex-grow: 1;
            font-size: 0.85rem;
            color: #cbd5e1;
            border-top: 1px solid rgba(255,255,255,0.2);
            border-bottom: 1px solid rgba(255,255,255,0.2);
            padding: 1rem 0;
            margin-bottom: 1rem;
            font-family: 'Merriweather', serif;
            font-style: italic;
        }

        /* CAJA DE RESPUESTA (QED) */
        .proof-box {
            background: rgba(0,0,0,0.3);
            padding: 1.5rem;
            border: 1px dashed rgba(255,255,255,0.3);
            position: relative;
            transition: all 0.5s;
        }

        .proof-box.unlocked {
            border-style: solid;
            border-color: var(--success);
            background: rgba(74, 222, 128, 0.1);
        }

        .status-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            display: block;
        }

        /* MATRIZ DECORATIVA EN EL FONDO DE LA TARJETA */
        .matrix-bg {
            font-family: 'Roboto Mono', monospace;
            font-size: 0.7rem;
            color: rgba(255,255,255,0.1);
            position: absolute;
            bottom: 10px;
            right: 10px;
            pointer-events: none;
            white-space: pre;
        }

        .math-input {
            width: 100%;
            background: transparent;
            border: none;
            border-bottom: 2px solid white;
            color: white;
            font-family: 'Roboto Mono', monospace;
            font-size: 1.2rem;
            padding: 10px;
            text-align: center;
            margin-bottom: 10px;
        }
        .math-input:focus { outline: none; border-color: var(--accent); }
        .math-input:disabled { opacity: 0.5; cursor: not-allowed; border-bottom-style: dashed; }

        .btn-verify {
            width: 100%;
            background: white;
            color: var(--bg-blueprint);
            font-weight: bold;
            border: none;
            padding: 10px;
            cursor: pointer;
        }
        .btn-verify:disabled { background: #94a3b8; cursor: not-allowed; }

        /* OVERLAY MATEMÁTICO */
        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(30, 58, 138, 0.95);
            display: none; justify-content: center; align-items: center; z-index: 20;
        }
        .overlay.active { display: flex; }

        .result-card {
            background: white;
            color: var(--bg-blueprint);
            padding: 3rem;
            text-align: center;
            border-radius: 2px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            max-width: 500px;
            border: 4px solid var(--accent);
        }

        .math-symbol { font-size: 3rem; margin-bottom: 1rem; color: var(--bg-blueprint); }
        .qed-text { font-family: 'Merriweather', serif; font-weight: bold; font-size: 1.5rem; margin-bottom: 1rem; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Responsive */
        @media (max-width: 900px) {
            #game-interface { grid-template-columns: 1fr; overflow-y: auto; }
            .board { grid-template-columns: repeat(8, 45px); grid-template-rows: repeat(8, 45px); }
            .square { font-size: 30px; }
        }
    </style>
</head>
<body>

    <header>
        <div>
            <h1>Álgebra Lineal Avanzada</h1>
            <span class="subtitle">Ejercicios Prácticos de Matrices</span>
        </div>
        <div style="text-align: right; font-size: 0.8rem;">
            LAB: MATRICES<br>PROYECTO FINAL
        </div>
    </header>

    <div id="mission-select-screen" class="screen active">
        <div class="intro-text">
            <p>"Una matriz es un arreglo bidimensional de números."</p>
            <br>
            <p>Resuelve el <strong>Jaque Mate</strong> para obtener los valores clave de cada operación matricial.</p>
        </div>
        
        <div class="cards-container">
            <div class="math-card" onclick="loadMission(1)">
                <div class="card-number">I</div>
                <div class="card-title">El Determinante</div>
                <div class="card-desc">
                    Calcula el determinante de la matriz 2x2 asociada al problema.
                    <br><br>
                    <strong>Objetivo:</strong> Hallar |A|
                </div>
                <div class="matrix-bg">| 1  0 |
| 0  1 |</div>
            </div>

            <div class="math-card" onclick="loadMission(2)">
                <div class="card-number">II</div>
                <div class="card-title">Matriz Identidad</div>
                <div class="card-desc">
                    Identifica el elemento neutro de la multiplicación matricial.
                    <br><br>
                    <strong>Objetivo:</strong> Nombre de la Matriz Iₙ
                </div>
                <div class="matrix-bg">[ 1  0 ]
[ 0  1 ]</div>
            </div>

            <div class="math-card" onclick="loadMission(3)">
                <div class="card-number">III</div>
                <div class="card-title">Sistemas Lineales</div>
                <div class="card-desc">
                    Método de resolución utilizando determinantes.
                    <br><br>
                    <strong>Objetivo:</strong> Regla de resolución.
                </div>
                <div class="matrix-bg">Ax = B</div>
            </div>
        </div>
    </div>

    <div id="game-interface" class="screen">
        <div class="board-wrapper">
            <div id="board" class="board"></div>

            <div id="victory-overlay" class="overlay">
                <div class="result-card">
                    <div class="math-symbol">A⁻¹</div>
                    <div class="qed-text">Solución Encontrada</div>
                    <p style="margin-bottom: 20px;">El valor de la incógnita matricial es:</p>
                    
                    <div id="hash-display" style="font-size: 2rem; font-weight: bold; font-family: 'Roboto Mono'; margin-bottom: 20px; color: #d946ef; border: 2px dashed #333; padding: 10px;">---</div>
                    
                    <p style="font-size: 0.8rem; color: #666; margin-bottom: 20px;">Copie este resultado en la caja de verificación.</p>
                    <button onclick="closeOverlay()" style="padding: 10px 20px; background: var(--bg-blueprint); color: white; border: none; cursor: pointer; font-weight:bold;">CERRAR Y VALIDAR</button>
                </div>
            </div>
        </div>

        <div class="side-panel">
            <button class="back-btn" onclick="returnToMenu()">← Volver a Selección</button>
            
            <h3 style="margin-bottom: 10px; font-family: 'Merriweather', serif;">Operaciones</h3>
            <div id="log-area" class="log-area">
                <div style="margin-bottom: 5px;">> Inicializando matriz A...</div>
            </div>

            <div id="proof-box" class="proof-box">
                <span id="status-label" class="status-label" style="color: #94a3b8;">⚠️ CÁLCULO PENDIENTE</span>
                
                <p style="font-size: 0.85rem; margin-bottom: 15px; opacity: 0.8;">
                    Desbloquea el campo resolviendo el mate para introducir la respuesta.
                </p>
                
                <input type="text" id="solution-input" class="math-input" placeholder="Respuesta..." disabled autocomplete="off">
                <button id="submit-btn" class="btn-verify" onclick="verifySolution()" disabled>VERIFICAR SOLUCIÓN</button>
                <div id="feedback-msg" style="text-align: center; margin-top: 10px; font-weight: bold; height: 20px;"></div>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURACIÓN DE EJERCICIOS DE MATRICES
        const missions = {
            1: {
                title: "Determinante",
                initial: [
                    ['', '', '', '', 'b', '', '', ''],
                    ['', '', 'p', '', 'B', '', 'p', ''],
                    ['', '', '', '', '', '', '', ''],
                    ['', '', 'P', '', '', 'p', 'P', ''],
                    ['', 'P', '', 'P', '', 'P', '', 'P'],
                    ['', '', 'p', '', 'K', '', 'p', ''],
                    ['', '', 'P', '', 'B', '', 'P', ''],
                    ['', '', '', '', 'k', '', '', '']
                ],
                solutionMoves: [
                    { w: {f:{r:3,c:6}, t:{r:2,c:6}}, b: {f:{r:1,c:2}, t:{r:2,c:2}} },
                    { w: {f:{r:4,c:7}, t:{r:3,c:7}}, b: {f:{r:0,c:4}, t:{r:1,c:3}} },
                    { w: {f:{r:1,c:4}, t:{r:4,c:7}}, b: {f:{r:1,c:3}, t:{r:0,c:2}} },
                    { w: {f:{r:4,c:7}, t:{r:5,c:6}}, b: null }
                ],
                // El usuario gana y ve: "DET(A) = 0". La respuesta es "0".
                fakeHash: "DET(A) = 0", 
                answer: "0" 
            },
            2: {
                title: "Matriz Identidad",
                initial: [
                    ['', '', 'k', '', '', '', '', ''],
                    ['', '', '', '', '', '', '', ''],
                    ['', '', '', '', 'K', '', '', ''],
                    ['', '', '', 'N', 'B', '', '', ''],
                    ['', '', '', '', 'N', '', '', ''],
                    ['', '', '', '', '', '', '', ''],
                    ['', '', '', '', '', '', '', ''],
                    ['', '', '', '', '', '', '', '']
                ],
                solutionMoves: [
                    { w: {f:{r:4,c:4}, t:{r:3,c:2}}, b: {f:{r:0,c:2}, t:{r:0,c:3}} },
                    { w: {f:{r:2,c:4}, t:{r:1,c:5}}, b: {f:{r:0,c:3}, t:{r:0,c:2}} },
                    { w: {f:{r:3,c:3}, t:{r:2,c:1}}, b: {f:{r:0,c:2}, t:{r:0,c:3}} },
                    { w: {f:{r:3,c:2}, t:{r:2,c:4}}, b: null }
                ],
                // El usuario gana y ve la matriz identidad. La respuesta es "IDENTIDAD".
                fakeHash: "[ 1  0 ]\n[ 0  1 ]",
                answer: "IDENTIDAD"
            },
            3: {
                title: "Regla de Cramer",
                initial: [
                    ['', 'n', '', 'b', '', 'r', 'k', ''],
                    ['', '', 'p', 'p', '', '', '', 'p'],
                    ['', '', '', 'p', '', '', 'p', 'Q'],
                    ['', '', '', 'R', '', 'p', '', ''],
                    ['', '', '', '', 'B', 'B', 'P', ''],
                    ['', '', '', 'P', 'R', '', 'P', ''],
                    ['', '', '', '', '', '', 'P', 'K'],
                    ['', '', '', '', '', '', '', '']
                ],
                solutionMoves: [
                    { w: {f:{r:3,c:3}, t:{r:3,c:5}}, b: {f:{r:0,c:5}, t:{r:3,c:5}} },
                    { w: {f:{r:4,c:4}, t:{r:3,c:3}}, b: {f:{r:3,c:5}, t:{r:3,c:3}} },
                    { w: {f:{r:5,c:4}, t:{r:0,c:4}}, b: {f:{r:0,c:6}, t:{r:1,c:5}} },
                    { w: {f:{r:2,c:7}, t:{r:0,c:5}}, b: null }
                ],
                // El usuario gana y ve "CRAMER". La respuesta es "CRAMER".
                fakeHash: "MÉTODO CRAMER",
                answer: "CRAMER"
            }
        };

        const pieces = { 'K': '♔', 'Q': '♕', 'R': '♖', 'B': '♗', 'N': '♘', 'P': '♙', 'k': '♚', 'q': '♛', 'r': '♜', 'b': '♝', 'n': '♞', 'p': '♟' };
        
        let currentMissionId = 1;
        let gameState = { position: [], moveIdx: 0, selection: null, locked: false };

        // --- NAVEGACIÓN ---
        function loadMission(id) {
            currentMissionId = id;
            document.getElementById('mission-select-screen').classList.remove('active');
            document.getElementById('game-interface').classList.add('active');
            
            gameState.position = JSON.parse(JSON.stringify(missions[id].initial));
            gameState.moveIdx = 0;
            gameState.selection = null;
            gameState.locked = false;
            
            lockInput();
            document.getElementById('log-area').innerHTML = '<div style="margin-bottom:5px;">> Ejercicio: ' + missions[id].title + ' cargado.</div>';
            document.getElementById('victory-overlay').classList.remove('active');
            drawBoard();
        }

        function returnToMenu() {
            document.getElementById('game-interface').classList.remove('active');
            document.getElementById('mission-select-screen').classList.add('active');
        }

        // --- LÓGICA DE JUEGO ---
        function drawBoard() {
            const board = document.getElementById('board');
            board.innerHTML = '';
            
            for(let r=0; r<8; r++) {
                for(let c=0; c<8; c++) {
                    const sq = document.createElement('div');
                    sq.className = `square ${(r+c)%2===0 ? 'light' : 'dark'}`;
                    
                    const p = gameState.position[r][c];
                    if(p) {
                        sq.innerText = pieces[p];
                        // Estilo clásico: Blancas son Blancas, Negras son Negras
                        if(p === p.toUpperCase()) {
                            sq.style.color = '#fff'; 
                            sq.style.textShadow = '0 1px 2px rgba(0,0,0,0.5)';
                        } else {
                            sq.style.color = '#1e3a8a'; 
                        }
                    }
                    sq.onclick = () => handleSquare(r, c);
                    if(gameState.selection && gameState.selection.r === r && gameState.selection.c === c) {
                        sq.classList.add('selected');
                    }
                    board.appendChild(sq);
                }
            }
        }

        function handleSquare(r, c) {
            if(gameState.locked) return;
            const p = gameState.position[r][c];
            if(p && p === p.toUpperCase()) {
                gameState.selection = {r, c};
                drawBoard();
                return;
            }
            if(gameState.selection) {
                const solution = missions[currentMissionId].solutionMoves;
                if (gameState.moveIdx >= solution.length) return;

                const correctMove = solution[gameState.moveIdx].w;
                if(correctMove.f.r === gameState.selection.r && correctMove.f.c === gameState.selection.c &&
                   correctMove.t.r === r && correctMove.t.c === c) {
                    executeMove(gameState.selection, {r, c}, true);
                } else {
                    log("❌ Cálculo de movimiento erróneo.");
                    gameState.selection = null;
                    drawBoard();
                }
            }
        }

        function executeMove(from, to, isPlayer) {
            const p = gameState.position[from.r][from.c];
            gameState.position[to.r][to.c] = p;
            gameState.position[from.r][from.c] = '';
            
            const coord = `${String.fromCharCode(97+from.c)}${8-from.r} → ${String.fromCharCode(97+to.c)}${8-to.r}`;
            log((isPlayer ? "Usted" : "CPU") + ": " + coord);
            
            gameState.selection = null;
            drawBoard();
            
            if(isPlayer) {
                const step = missions[currentMissionId].solutionMoves[gameState.moveIdx];
                if(!step.b) {
                    setTimeout(missionComplete, 500);
                } else {
                    gameState.locked = true;
                    setTimeout(() => {
                        executeMove(step.b.f, step.b.t, false);
                        gameState.moveIdx++;
                        gameState.locked = false;
                    }, 800);
                }
            }
        }

        function missionComplete() {
            log("✅ Ejercicio Resuelto.");
            const mission = missions[currentMissionId];
            document.getElementById('hash-display').innerText = mission.fakeHash;
            document.getElementById('victory-overlay').classList.add('active');
            unlockInput();
        }

        function closeOverlay() {
            document.getElementById('victory-overlay').classList.remove('active');
        }

        // --- INPUT SISTEMA ---
        function lockInput() {
            const box = document.getElementById('proof-box');
            const inp = document.getElementById('solution-input');
            const btn = document.getElementById('submit-btn');
            const lbl = document.getElementById('status-label');
            
            box.classList.remove('unlocked');
            inp.disabled = true;
            inp.value = '';
            inp.placeholder = "Bloqueado";
            btn.disabled = true;
            lbl.innerText = "⚠️ CÁLCULO PENDIENTE";
            lbl.style.color = "#94a3b8";
            document.getElementById('feedback-msg').innerText = '';
        }

        function unlockInput() {
            const box = document.getElementById('proof-box');
            const inp = document.getElementById('solution-input');
            const btn = document.getElementById('submit-btn');
            const lbl = document.getElementById('status-label');
            
            box.classList.add('unlocked');
            inp.disabled = false;
            inp.placeholder = "Ingrese el resultado";
            inp.focus();
            btn.disabled = false;
            lbl.innerText = "✏️ LISTO PARA VALIDAR";
            lbl.style.color = "var(--success)";
        }

        function verifySolution() {
            const val = document.getElementById('solution-input').value.toUpperCase().trim();
            const correct = missions[currentMissionId].answer;
            const fb = document.getElementById('feedback-msg');
            
            if(val === correct) {
                fb.innerText = "¡CORRECTO!";
                fb.style.color = "var(--success)";
                setTimeout(() => { alert("¡Ejercicio Completado! Volviendo al menú."); returnToMenu(); }, 1000);
            } else {
                fb.innerText = "INCORRECTO";
                fb.style.color = "#ef4444";
            }
        }

        function log(msg) {
            const area = document.getElementById('log-area');
            const line = document.createElement('div');
            line.style.marginBottom = "5px";
            line.innerText = "> " + msg;
            area.appendChild(line);
            area.scrollTop = area.scrollHeight;
        }
    </script>
</body>
</html>
